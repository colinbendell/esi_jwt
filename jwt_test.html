<esi:comment text="
---- WARNING: GENERATED ESI ----
"/><esi:function name="assertEqual"><esi:assign name="name" value="$(ARGS{0})"/><esi:assign name="val" value="$(ARGS{1})"/><esi:assign name="expect" value="$(ARGS{2})"/><esi:assign name="message" value="'Fail! (expected: '+$(expect)+' but got: '+$(val)+') '"/><esi:choose><esi:when test="$(val)==$(expect)"><esi:assign name="message" value="'Pass'"/></esi:when></esi:choose><esi:return value="'Test '+$(name)+'... '+$(message)+'
'"/></esi:function><esi:function name="logical_right_shift"><esi:assign name="x" value="$(ARGS{0})"/><esi:assign name="n" value="$(ARGS{1})"/><esi:assign name="size" value="32"/><esi:return value="($(x)>>$(n))&(~(((1<<$(size))>>$(n))<<1))"/></esi:function><esi:function name="power"><esi:assign name="n" value="$(ARGS{0})"/><esi:assign name="exp" value="$(ARGS{1})"/><esi:assign name="val" value="1"/><esi:choose><esi:when test="$(exp)>1"><esi:assign name="val" value="$(n)*$power($(n),$(exp)-1)"/></esi:when><esi:when test="$(exp)==1"><esi:assign name="val" value="$(n)"/></esi:when></esi:choose><esi:return value="$(val)"/></esi:function><esi:function name="toBase16"><esi:assign name="val" value="$(ARGS{0})"/><esi:assign name="ret" value="$(hexLookup{$(val)%16})"/><esi:assign name="val" value="$(val)/16"/><esi:choose><esi:when test="$(val)>0"><esi:assign name="ret" value="$toBase16($(val))+$str($(ret))"/></esi:when></esi:choose><esi:return value="$str($(ret))"/></esi:function><esi:assign name="hexLookup" value="'0123456789abcdef'"/><esi:function name="toBase10"><esi:assign name="hex" value="$(ARGS{0})"/><esi:choose><esi:when test="$is_empty($(hex))"><esi:return value="0"/></esi:when></esi:choose><esi:assign name="c" value="$index($(hexLookup),$(hex{0}))"/><esi:assign name="c" value="$(c)*$power(16,$len($(hex))-1)"/><esi:choose><esi:when test="$len($(hex))>1"><esi:assign name="c" value="$(c)+$toBase10($substr($(hex),1))"/></esi:when></esi:choose><esi:return value="$(c)"/></esi:function><esi:function name="toHex"><esi:assign name="number" value="$(ARGS{0})"/><esi:assign name="nstr" value="$toBase16($(number))"/><esi:choose><esi:when test="($len($(nstr))%2)==0"><esi:return value="$(nstr)"/></esi:when></esi:choose><esi:return value="'0'+$(nstr)"/></esi:function><esi:assign name="b64array" value="'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/='"/><esi:function name="hexToBase64"><esi:assign name="input" value="$(ARGS{0})"/><esi:assign name="b64value" value="''"/><esi:assign name="i" value="0"/><esi:foreach collection="[0..((($len($(input))+5)/6)-1)]" item="i"><esi:assign name="chr1" value="$toBase10($(input{($(i)*6)+0})+$(input{($(i)*6)+1}))"/><esi:assign name="chr2" value="$toBase10($(input{($(i)*6)+2})+$(input{($(i)*6)+3}))"/><esi:assign name="chr3" value="$toBase10($(input{($(i)*6)+4})+$(input{($(i)*6)+5}))"/><esi:assign name="enc1" value="$(chr1)>>2"/><esi:assign name="enc2" value="(($(chr1)&3)<<4)|($(chr2)>>4)"/><esi:assign name="enc3" value="(($(chr2)&15)<<2)|($(chr3)>>6)"/><esi:assign name="enc4" value="$(chr3)&63"/><esi:choose><esi:when test="(($(i)*6)+3)>$len($(input))"><esi:assign name="enc3" value="64"/><esi:assign name="enc4" value="$(enc3)"/></esi:when><esi:when test="(($(i)*6)+5)>$len($(input))"><esi:assign name="enc4" value="64"/></esi:when></esi:choose><esi:assign name="b64value" value="$(b64value)+($(b64array{$(enc1)})+$(b64array{$(enc2)})+$(b64array{$(enc3)})+$(b64array{$(enc4)}))"/></esi:foreach><esi:return value="$(b64value)"/></esi:function><esi:function name="base64toHex"><esi:assign name="input" value="$(ARGS{0})"/><esi:assign name="output" value="''"/><esi:assign name="i" value="0"/><esi:choose><esi:when test="($index($(input),'-')>=0)||($index($(input),'_')>=0)"><esi:assign name="input" value="$replace($replace($(input),'-','+'),'_','/')"/></esi:when></esi:choose><esi:foreach collection="[0..((($len($(input))+3)/4)-1)]" item="i"><esi:assign name="enc1" value="$index($(b64array),$(input{($(i)*4)+0}))"/><esi:assign name="enc2" value="$index($(b64array),$(input{($(i)*4)+1}|'='))"/><esi:assign name="enc3" value="$index($(b64array),$(input{($(i)*4)+2}|'='))"/><esi:assign name="enc4" value="$index($(b64array),$(input{($(i)*4)+3}|'='))"/><esi:assign name="chr1" value="($(enc1)<<2)|($(enc2)>>4)"/><esi:assign name="chr2" value="(($(enc2)&15)<<4)|($(enc3)>>2)"/><esi:assign name="chr3" value="(($(enc3)&3)<<6)|$(enc4)"/><esi:assign name="output" value="$(output)+$toHex($(chr1))"/><esi:choose><esi:when test="$(enc3)!=64"><esi:assign name="output" value="$(output)+$toHex($(chr2))"/></esi:when></esi:choose><esi:choose><esi:when test="$(enc4)!=64"><esi:assign name="output" value="$(output)+$toHex($(chr3))"/></esi:when></esi:choose></esi:foreach><esi:return value="$(output)"/></esi:function><esi:function name="base64url_decode"><esi:assign name="input" value="$(ARGS{0})"/><esi:assign name="input" value="$replace($replace($(input),'-','+'),'_','/')"/><esi:choose><esi:when test="($len($(input))%4)==2"><esi:assign name="input" value="$(input)+'=='"/></esi:when></esi:choose><esi:choose><esi:when test="($len($(input))%4)==3"><esi:assign name="input" value="$(input)+'='"/></esi:when></esi:choose><esi:return value="$base64_decode($(input))"/></esi:function><esi:function name="findCert"><esi:assign name="certs" value="$(ARGS{0})"/><esi:assign name="kid" value="$(ARGS{1}|'')"/><esi:assign name="key" value="$(certs{0})"/><esi:choose><esi:when test="$(key{'kid'})==$(kid)"><esi:return value="$(key)"/></esi:when></esi:choose><esi:choose><esi:when test="$len($(certs))>1">$list_delitem($(certs),0)<esi:return value="$findCert($(certs),$(kid))"/></esi:when></esi:choose><esi:return value="{}"/></esi:function><esi:function name="parseJWT"><esi:assign name="jwt" value="$(ARGS{0})"/><esi:assign name="parts" value="$string_split($(jwt),'.')"/><esi:assign name="header" value="$base64url_decode($(parts{0}))"/><esi:assign name="payload" value="$base64url_decode($(parts{1}))"/><esi:assign name="message" value="$(parts{0})+'.'+$(parts{1})"/><esi:assign name="signature" value="$(parts{2})"/><esi:choose><esi:when test="($len($(signature))%4)==2"><esi:assign name="signature" value="$(signature)+'=='"/></esi:when></esi:choose><esi:choose><esi:when test="($len($(signature))%4)==3"><esi:assign name="signature" value="$(signature)+'='"/></esi:when></esi:choose><esi:assign name="items">$string_split($(header),'"')</esi:assign><esi:assign name="kid" value="$(items{7}|$(items{5}|''))"/><esi:assign name="jwtObject" value="{'token':$(jwt),'header':$(header),'payload':$(payload),'message':$(message),'kid':$(kid),'signature':$(signature)}"/><esi:return value="$(jwtObject)"/></esi:function><esi:assign name="jwks_test" value="{'keys':[{'kty':'RSA','alg':'RS256','use':'sig','kid':'70484949aa0a58ac391c3883ee2d3f62e93bf780','n':'412CDT2txyBC1tEs5QEafP1mGgh2Q0c-oVP96WPuw2FiWVbEOsXu_hLoSP3hU75M0b832h6Tq13GijGsHLxIKzZrP1QQ6SRh3PCqY_ox_K-QjfFayqRsAsHkR2nEciOvrnTc5EbxOK1uXu8rbVEV8pFl6h_BZneClTcsehI_WYB--3fHDz9RDtJV97UIq2UdcafzaTFl76DLoWb4hQuNIby1ujXy_5tcJbZHpvSBEzq99AaRuSsYVmnYDNqDTu0qQOGKs55UeHKVpH5TrwX6CG2yitpePBcFbHhf5iOXUULFC8PBakgWGUGQTpKnpvevutRJ3ISoobIG61ANy-H3uQ==','e':'AQAB'},{'kty':'RSA','alg':'RS256','use':'sig','kid':'ca04df587b5a7cead80abee9ea8dcf7586a78e01','n':'iXn-WmrwLLBa-QDiToBozpu4Y4ThKdwORWFXQa9I75pKOvPUjUjE2Bk05TUSt7-V7KDjCq0_Nkd-X9rMRV5LKgCa0_F8YgI30QS3bUm9orFryrdOc65PUIVFVxIwMZuGDY1hj6HEJVWIr0CZdcgNIll06BasclckkUK4O-Eh7MaQrqb646ghFlG3zlgk9b2duHbDOq3s39ICPinRQWC6NqTYfqg7E8GN_NLY9srUCc_MswuUfMJ2cKT6edrhLuIwIj_74YGkpOwilr2VswKsvJ7dcoiJxheKYvKDKtZFkbKrWETTJSGX2Xeh0DFB0lqbKLVvqkM2lFU2Qx1OgtTnrw==','e':'AQAB'}]}"/><esi:assign name="kid" value="'ca04df587b5a7cead80abee9ea8dcf7586a78e01'"/><esi:assign name="cert" value="{'kty':'RSA','alg':'RS256','use':'sig','kid':'ca04df587b5a7cead80abee9ea8dcf7586a78e01','n':'iXn-WmrwLLBa-QDiToBozpu4Y4ThKdwORWFXQa9I75pKOvPUjUjE2Bk05TUSt7-V7KDjCq0_Nkd-X9rMRV5LKgCa0_F8YgI30QS3bUm9orFryrdOc65PUIVFVxIwMZuGDY1hj6HEJVWIr0CZdcgNIll06BasclckkUK4O-Eh7MaQrqb646ghFlG3zlgk9b2duHbDOq3s39ICPinRQWC6NqTYfqg7E8GN_NLY9srUCc_MswuUfMJ2cKT6edrhLuIwIj_74YGkpOwilr2VswKsvJ7dcoiJxheKYvKDKtZFkbKrWETTJSGX2Xeh0DFB0lqbKLVvqkM2lFU2Qx1OgtTnrw==','e':'AQAB'}"/><esi:vars>$assertEqual('findCert({"keys": [...]}, "ca04df587b5a7...8dcf7586a78e01")',$findCert($(jwks_test{'keys'}),$(kid)),$str($(cert)))</esi:vars><esi:assign name="jwt_test" value="'eyJhbGciOiJSUzI1NiIsImtpZCI6ImNhMDRkZjU4N2I1YTdjZWFkODBhYmVlOWVhOGRjZjc1ODZhNzhlMDEifQ.eyJhenAiOiI0NTQ1MzQ2ODUxNi01bXAwZjVpN3I2c2xjazE4ZW9hZTg3Y2s3b2ZxcjNzby5hcHBzLmdvb2dsZXVzZXJjb250ZW50LmNvbSIsImF1ZCI6IjQ1NDUzNDY4NTE2LTVtcDBmNWk3cjZzbGNrMThlb2FlODdjazdvZnFyM3NvLmFwcHMuZ29vZ2xldXNlcmNvbnRlbnQuY29tIiwic3ViIjoiMTA0NTY0NjEwMDUzNzQ0NTMwMTExIiwiaGQiOiJha2FtYWkuY29tIiwiZW1haWwiOiJjb2xpbmJAYWthbWFpLmNvbSIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJhdF9oYXNoIjoiUnQtSmFtcGtzaGd1NDh4TkxuQlpoQSIsImlzcyI6ImFjY291bnRzLmdvb2dsZS5jb20iLCJpYXQiOjE1MDI3Njc1NTAsImV4cCI6MTUwMjc3MTE1MCwibmFtZSI6IkNvbGluIEJlbmRlbGwiLCJwaWN0dXJlIjoiaHR0cHM6Ly9saDQuZ29vZ2xldXNlcmNvbnRlbnQuY29tLy1sZGt2MDM4dTdKYy9BQUFBQUFBQUFBSS9BQUFBQUFBQUFUay9WWDdiUDdKeWo2MC9zOTYtYy9waG90by5qcGciLCJnaXZlbl9uYW1lIjoiQ29saW4iLCJmYW1pbHlfbmFtZSI6IkJlbmRlbGwiLCJsb2NhbGUiOiJlbi1DQSJ9.IXp3wfMdzy9JLfDr51vkbPstlfcqVZK1tu8Su6XaDzz9aQbEdOG0tktECdKlAoyw1E2RrFYqzHbuk2CcJ-cUy5Mcerar-h5cbBglMxZkk9DOrd0iDjqW0mhCBkXiM9VavGjunhrzunPFRoVaLG6_j965UVnXY3gVnZIcMdFOLCyknmjpDJBlw1GGFEw3IyiyFuJFm1bDPZk0mMVNF0a2nKx_4386VX_SqZwHM_WszmIdlcnTIDS7LxTzm2IdHZ65ufFacvq4KPRtNxz_mterYRzUBSpWviiHm1ZAyUelIny6cwP_k4NR3--5UP2cSbFbSIG2hS1cw7gPWJXjGzi0-Q'"/><esi:assign name="parsed_jwt">{'header':'{"alg":"RS256","kid":"ca04df587b5a7cead80abee9ea8dcf7586a78e01"}','payload':'{"azp":"45453468516-5mp0f5i7r6slck18eoae87ck7ofqr3so.apps.googleusercontent.com","aud":"45453468516-5mp0f5i7r6slck18eoae87ck7ofqr3so.apps.googleusercontent.com","sub":"104564610053744530111","hd":"akamai.com","email":"colinb@akamai.com","email_verified":true,"at_hash":"Rt-Jampkshgu48xNLnBZhA","iss":"accounts.google.com","iat":1502767550,"exp":1502771150,"name":"Colin Bendell","picture":"https://lh4.googleusercontent.com/-ldkv038u7Jc/AAAAAAAAAAI/AAAAAAAAATk/VX7bP7Jyj60/s96-c/photo.jpg","given_name":"Colin","family_name":"Bendell","locale":"en-CA"}','token':'eyJhbGciOiJSUzI1NiIsImtpZCI6ImNhMDRkZjU4N2I1YTdjZWFkODBhYmVlOWVhOGRjZjc1ODZhNzhlMDEifQ.eyJhenAiOiI0NTQ1MzQ2ODUxNi01bXAwZjVpN3I2c2xjazE4ZW9hZTg3Y2s3b2ZxcjNzby5hcHBzLmdvb2dsZXVzZXJjb250ZW50LmNvbSIsImF1ZCI6IjQ1NDUzNDY4NTE2LTVtcDBmNWk3cjZzbGNrMThlb2FlODdjazdvZnFyM3NvLmFwcHMuZ29vZ2xldXNlcmNvbnRlbnQuY29tIiwic3ViIjoiMTA0NTY0NjEwMDUzNzQ0NTMwMTExIiwiaGQiOiJha2FtYWkuY29tIiwiZW1haWwiOiJjb2xpbmJAYWthbWFpLmNvbSIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJhdF9oYXNoIjoiUnQtSmFtcGtzaGd1NDh4TkxuQlpoQSIsImlzcyI6ImFjY291bnRzLmdvb2dsZS5jb20iLCJpYXQiOjE1MDI3Njc1NTAsImV4cCI6MTUwMjc3MTE1MCwibmFtZSI6IkNvbGluIEJlbmRlbGwiLCJwaWN0dXJlIjoiaHR0cHM6Ly9saDQuZ29vZ2xldXNlcmNvbnRlbnQuY29tLy1sZGt2MDM4dTdKYy9BQUFBQUFBQUFBSS9BQUFBQUFBQUFUay9WWDdiUDdKeWo2MC9zOTYtYy9waG90by5qcGciLCJnaXZlbl9uYW1lIjoiQ29saW4iLCJmYW1pbHlfbmFtZSI6IkJlbmRlbGwiLCJsb2NhbGUiOiJlbi1DQSJ9.IXp3wfMdzy9JLfDr51vkbPstlfcqVZK1tu8Su6XaDzz9aQbEdOG0tktECdKlAoyw1E2RrFYqzHbuk2CcJ-cUy5Mcerar-h5cbBglMxZkk9DOrd0iDjqW0mhCBkXiM9VavGjunhrzunPFRoVaLG6_j965UVnXY3gVnZIcMdFOLCyknmjpDJBlw1GGFEw3IyiyFuJFm1bDPZk0mMVNF0a2nKx_4386VX_SqZwHM_WszmIdlcnTIDS7LxTzm2IdHZ65ufFacvq4KPRtNxz_mterYRzUBSpWviiHm1ZAyUelIny6cwP_k4NR3--5UP2cSbFbSIG2hS1cw7gPWJXjGzi0-Q','message':'eyJhbGciOiJSUzI1NiIsImtpZCI6ImNhMDRkZjU4N2I1YTdjZWFkODBhYmVlOWVhOGRjZjc1ODZhNzhlMDEifQ.eyJhenAiOiI0NTQ1MzQ2ODUxNi01bXAwZjVpN3I2c2xjazE4ZW9hZTg3Y2s3b2ZxcjNzby5hcHBzLmdvb2dsZXVzZXJjb250ZW50LmNvbSIsImF1ZCI6IjQ1NDUzNDY4NTE2LTVtcDBmNWk3cjZzbGNrMThlb2FlODdjazdvZnFyM3NvLmFwcHMuZ29vZ2xldXNlcmNvbnRlbnQuY29tIiwic3ViIjoiMTA0NTY0NjEwMDUzNzQ0NTMwMTExIiwiaGQiOiJha2FtYWkuY29tIiwiZW1haWwiOiJjb2xpbmJAYWthbWFpLmNvbSIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJhdF9oYXNoIjoiUnQtSmFtcGtzaGd1NDh4TkxuQlpoQSIsImlzcyI6ImFjY291bnRzLmdvb2dsZS5jb20iLCJpYXQiOjE1MDI3Njc1NTAsImV4cCI6MTUwMjc3MTE1MCwibmFtZSI6IkNvbGluIEJlbmRlbGwiLCJwaWN0dXJlIjoiaHR0cHM6Ly9saDQuZ29vZ2xldXNlcmNvbnRlbnQuY29tLy1sZGt2MDM4dTdKYy9BQUFBQUFBQUFBSS9BQUFBQUFBQUFUay9WWDdiUDdKeWo2MC9zOTYtYy9waG90by5qcGciLCJnaXZlbl9uYW1lIjoiQ29saW4iLCJmYW1pbHlfbmFtZSI6IkJlbmRlbGwiLCJsb2NhbGUiOiJlbi1DQSJ9','signature':'IXp3wfMdzy9JLfDr51vkbPstlfcqVZK1tu8Su6XaDzz9aQbEdOG0tktECdKlAoyw1E2RrFYqzHbuk2CcJ-cUy5Mcerar-h5cbBglMxZkk9DOrd0iDjqW0mhCBkXiM9VavGjunhrzunPFRoVaLG6_j965UVnXY3gVnZIcMdFOLCyknmjpDJBlw1GGFEw3IyiyFuJFm1bDPZk0mMVNF0a2nKx_4386VX_SqZwHM_WszmIdlcnTIDS7LxTzm2IdHZ65ufFacvq4KPRtNxz_mterYRzUBSpWviiHm1ZAyUelIny6cwP_k4NR3--5UP2cSbFbSIG2hS1cw7gPWJXjGzi0-Q==','kid':'ca04df587b5a7cead80abee9ea8dcf7586a78e01'}</esi:assign><esi:vars>$assertEqual('parseJWT("eyJhbGciOi...Gzi0-Q")',$parseJWT($(jwt_test)),$str($(parsed_jwt)))</esi:vars>