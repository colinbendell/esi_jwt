<esi:comment text="
---- WARNING: GENERATED ESI ----
"/><esi:function name="assertEqual"><esi:assign name="name" value="$(ARGS{0})"/><esi:assign name="val" value="$(ARGS{1})"/><esi:assign name="expect" value="$(ARGS{2})"/><esi:assign name="message" value="'Fail! (expected: '+$(expect)+' but got: '+$(val)+') '"/><esi:choose><esi:when test="$(val)==$(expect)"><esi:assign name="message" value="'Pass'"/></esi:when></esi:choose><esi:return value="'Test '+$(name)+'... '+$(message)+'
'"/></esi:function><esi:function name="logical_right_shift"><esi:assign name="x" value="$(ARGS{0})"/><esi:assign name="n" value="$(ARGS{1})"/><esi:assign name="size" value="32"/><esi:return value="($(x)>>$(n))&(~(((1<<$(size))>>$(n))<<1))"/></esi:function><esi:function name="power"><esi:assign name="n" value="$(ARGS{0})"/><esi:assign name="exp" value="$(ARGS{1})"/><esi:assign name="val" value="1"/><esi:choose><esi:when test="$(exp)>1"><esi:assign name="val" value="$(n)*$power($(n),$(exp)-1)"/></esi:when><esi:when test="$(exp)==1"><esi:assign name="val" value="$(n)"/></esi:when></esi:choose><esi:return value="$(val)"/></esi:function><esi:function name="toBase16"><esi:assign name="val" value="$(ARGS{0})"/><esi:assign name="ret" value="$(HEX_CHARS{$(val)%16})"/><esi:assign name="val" value="$(val)/16"/><esi:choose><esi:when test="$(val)>0"><esi:assign name="ret" value="$toBase16($(val))+$str($(ret))"/></esi:when></esi:choose><esi:return value="$str($(ret))"/></esi:function><esi:assign name="HEX_CHARS" value="'0123456789abcdef'"/><esi:function name="toBase10"><esi:assign name="hex" value="$(ARGS{0})"/><esi:choose><esi:when test="$is_empty($(hex))"><esi:return value="0"/></esi:when></esi:choose><esi:assign name="c" value="$index($(HEX_CHARS),$(hex{0}))"/><esi:assign name="c" value="$(c)*$power(16,$len($(hex))-1)"/><esi:choose><esi:when test="$len($(hex))>1"><esi:assign name="c" value="$(c)+$toBase10($substr($(hex),1))"/></esi:when></esi:choose><esi:return value="$(c)"/></esi:function><esi:function name="toHex"><esi:assign name="number" value="$(ARGS{0})"/><esi:assign name="nstr" value="$toBase16($(number))"/><esi:choose><esi:when test="($len($(nstr))%2)==0"><esi:return value="$(nstr)"/></esi:when></esi:choose><esi:return value="'0'+$(nstr)"/></esi:function><esi:assign name="BASE64_CHARS" value="'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/='"/><esi:function name="hexToBase64"><esi:assign name="input" value="$(ARGS{0})"/><esi:assign name="b64value" value="''"/><esi:assign name="i" value="0"/><esi:assign name="_loop" value="[0..((($len($(input))+5)/6)-1)]"/><esi:foreach collection="$(_loop)"><esi:choose><esi:when test="!($(i)<=((($len($(input))+5)/6)-1))"><esi:break/></esi:when></esi:choose><esi:assign name="chr1" value="$toBase10($(input{($(i)*6)+0})+$(input{($(i)*6)+1}))"/><esi:assign name="chr2" value="$toBase10($(input{($(i)*6)+2})+$(input{($(i)*6)+3}))"/><esi:assign name="chr3" value="$toBase10($(input{($(i)*6)+4})+$(input{($(i)*6)+5}))"/><esi:assign name="enc1" value="$(chr1)>>2"/><esi:assign name="enc2" value="(($(chr1)&3)<<4)|($(chr2)>>4)"/><esi:assign name="enc3" value="(($(chr2)&15)<<2)|($(chr3)>>6)"/><esi:assign name="enc4" value="$(chr3)&63"/><esi:choose><esi:when test="(($(i)*6)+3)>$len($(input))"><esi:assign name="enc3" value="64"/><esi:assign name="enc4" value="$(enc3)"/></esi:when><esi:when test="(($(i)*6)+5)>$len($(input))"><esi:assign name="enc4" value="64"/></esi:when></esi:choose><esi:assign name="b64value" value="$(b64value)+($(BASE64_CHARS{$(enc1)})+$(BASE64_CHARS{$(enc2)})+$(BASE64_CHARS{$(enc3)})+$(BASE64_CHARS{$(enc4)}))"/><esi:assign name="i" value="$(i)+1"/></esi:foreach><esi:return value="$(b64value)"/></esi:function><esi:function name="base64toHex"><esi:assign name="input" value="$(ARGS{0})"/><esi:assign name="output" value="''"/><esi:choose><esi:when test="($index($(input),'-')>=0)||($index($(input),'_')>=0)"><esi:assign name="input" value="$replace($replace($(input),'-','+'),'_','/')"/></esi:when></esi:choose><esi:assign name="i" value="0"/><esi:assign name="_loop" value="[0..((($len($(input))+3)/4)-1)]"/><esi:foreach collection="$(_loop)"><esi:choose><esi:when test="!($(i)<=((($len($(input))+3)/4)-1))"><esi:break/></esi:when></esi:choose><esi:assign name="enc1" value="$index($(BASE64_CHARS),$(input{($(i)*4)+0}))"/><esi:assign name="enc2" value="$index($(BASE64_CHARS),$(input{($(i)*4)+1}|'='))"/><esi:assign name="enc3" value="$index($(BASE64_CHARS),$(input{($(i)*4)+2}|'='))"/><esi:assign name="enc4" value="$index($(BASE64_CHARS),$(input{($(i)*4)+3}|'='))"/><esi:assign name="chr1" value="($(enc1)<<2)|($(enc2)>>4)"/><esi:assign name="chr2" value="(($(enc2)&15)<<4)|($(enc3)>>2)"/><esi:assign name="chr3" value="(($(enc3)&3)<<6)|$(enc4)"/><esi:assign name="output" value="$(output)+$toHex($(chr1))"/><esi:choose><esi:when test="$(enc3)!=64"><esi:assign name="output" value="$(output)+$toHex($(chr2))"/></esi:when></esi:choose><esi:choose><esi:when test="$(enc4)!=64"><esi:assign name="output" value="$(output)+$toHex($(chr3))"/></esi:when></esi:choose><esi:assign name="i" value="$(i)+1"/></esi:foreach><esi:assign name="x" value="0"/><esi:assign name="x" value="$(x)+1"/><esi:return value="$(output)"/></esi:function><esi:function name="base64url_decode"><esi:assign name="input" value="$(ARGS{0})"/><esi:assign name="input" value="$replace($replace($(input),'-','+'),'_','/')"/><esi:choose><esi:when test="($len($(input))%4)==2"><esi:assign name="input" value="$(input)+'=='"/></esi:when></esi:choose><esi:choose><esi:when test="($len($(input))%4)==3"><esi:assign name="input" value="$(input)+'='"/></esi:when></esi:choose><esi:return value="$base64_decode($(input))"/></esi:function><esi:function name="prepadSigned"><esi:assign name="hexStr" value="$(ARGS{0})"/><esi:assign name="msb" value="$index($(HEX_CHARS),$(hexStr{0}))"/><esi:choose><esi:when test="$(msb)>=8"><esi:return value="'00'+$(hexStr)"/></esi:when><esi:otherwise><esi:return value="$(hexStr)"/></esi:otherwise></esi:choose></esi:function><esi:function name="encodeLengthHex"><esi:assign name="n" value="$(ARGS{0})"/><esi:choose><esi:when test="$(n)<=127"><esi:return value="$toHex($(n))"/></esi:when><esi:otherwise><esi:assign name="n_hex" value="$toHex($(n))"/><esi:assign name="length_of_length_byte" value="128+($len($(n_hex))/2)"/><esi:return value="$toHex($(length_of_length_byte))+$(n_hex)"/></esi:otherwise></esi:choose></esi:function><esi:function name="formatPem"><esi:assign name="value" value="$(ARGS{0})"/><esi:assign name="returnValue" value="$substr($(value),0,64)"/><esi:choose><esi:when test="$len($(value))>=64"><esi:assign name="returnValue">$(returnValue)+('
'+$formatPem($substr($(value),64)))</esi:assign></esi:when></esi:choose><esi:return value="$(returnValue)"/></esi:function><esi:function name="rsaPublicKeyPem"><esi:assign name="modulus_b64" value="$(ARGS{0}|'00')"/><esi:assign name="exponent_b64" value="$(ARGS{1}|'00')"/><esi:assign name="modulus_hex" value="$base64toHex($(modulus_b64))"/><esi:assign name="exponent_hex" value="$base64toHex($(exponent_b64))"/><esi:assign name="modulus_hex" value="$prepadSigned($(modulus_hex))"/><esi:assign name="exponent_hex" value="$prepadSigned($(exponent_hex))"/><esi:assign name="modlen" value="$len($(modulus_hex))/2"/><esi:assign name="explen" value="$len($(exponent_hex))/2"/><esi:assign name="encoded_modlen" value="$encodeLengthHex($(modlen))"/><esi:assign name="encoded_explen" value="$encodeLengthHex($(explen))"/><esi:assign name="encoded_pubkey" value="'30'+$encodeLengthHex($(modlen)+$(explen)+($len($(encoded_modlen))/2)+($len($(encoded_explen))/2)+2)+'02'+$(encoded_modlen)+$(modulus_hex)+'02'+$(encoded_explen)+$(exponent_hex)"/><esi:assign name="seq2" value="'300d'+'06092a864886f70d010101'+'0500'+'03'+$encodeLengthHex(($len($(encoded_pubkey))/2)+1)+'00'+$(encoded_pubkey)"/><esi:assign name="der_hex" value="'30'+$encodeLengthHex($len($(seq2))/2)+$(seq2)"/><esi:return value="'-----BEGIN PUBLIC KEY-----
'+$formatPem($hexToBase64($(der_hex)))+'
-----END PUBLIC KEY-----
'"/></esi:function><esi:vars>$assertEqual('prepadSigned(\'ffff\')',$prepadSigned('ffff'),'00ffff')</esi:vars><esi:vars>$assertEqual('prepadSigned(\'010001\')',$prepadSigned('010001'),'010001')</esi:vars><esi:vars>$assertEqual('encodeLengthHex(16)',$encodeLengthHex(16),'10')</esi:vars><esi:vars>$assertEqual('encodeLengthHex(65535)',$encodeLengthHex(65535),'82ffff')</esi:vars><esi:vars>$assertEqual('encodeLengthHex(65535)',$encodeLengthHex(65535),'82ffff')</esi:vars><esi:vars>$assertEqual('formatPem(\'MIIBIjA...+pTdOQIDAQAB\')',$formatPem('MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA9jc7TbIST7FQQb1CkAunhGaOaqGk7B4sLmBGIgIxjhMWtn5EtoiQ1ZT6BYcWorCB2UkfOgFBB4TUZnYMDL2DOQIDAQAB'),'MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA9jc7TbIST7FQQb1CkAun
hGaOaqGk7B4sLmBGIgIxjhMWtn5EtoiQ1ZT6BYcWorCB2UkfOgFBB4TUZnYMDL2D
OQIDAQAB')</esi:vars><esi:assign name="modulus" value="'iXn-WmrwLLBa-QDiToBozpu4Y4ThKdwORWFXQa9I75pKOvPUjUjE2Bk05TUSt7-V7KDjCq0_Nkd-X9rMRV5LKgCa0_F8YgI30QS3bUm9orFryrdOc65PUIVFVxIwMZuGDY1hj6HEJVWIr0CZdcgNIll06BasclckkUK4O-Eh7MaQrqb646ghFlG3zlgk9b2duHbDOq3s39ICPinRQWC6NqTYfqg7E8GN_NLY9srUCc_MswuUfMJ2cKT6edrhLuIwIj_74YGkpOwilr2VswKsvJ7dcoiJxheKYvKDKtZFkbKrWETTJSGX2Xeh0DFB0lqbKLVvqkM2lFU2Qx1OgtTnrw=='"/><esi:assign name="exponent" value="'AQAB'"/><esi:assign name="pem">'-----BEGIN PUBLIC KEY-----
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAiXn+WmrwLLBa+QDiToBo
zpu4Y4ThKdwORWFXQa9I75pKOvPUjUjE2Bk05TUSt7+V7KDjCq0/Nkd+X9rMRV5L
KgCa0/F8YgI30QS3bUm9orFryrdOc65PUIVFVxIwMZuGDY1hj6HEJVWIr0CZdcgN
Ill06BasclckkUK4O+Eh7MaQrqb646ghFlG3zlgk9b2duHbDOq3s39ICPinRQWC6
NqTYfqg7E8GN/NLY9srUCc/MswuUfMJ2cKT6edrhLuIwIj/74YGkpOwilr2VswKs
vJ7dcoiJxheKYvKDKtZFkbKrWETTJSGX2Xeh0DFB0lqbKLVvqkM2lFU2Qx1OgtTn
rwIDAQAB
-----END PUBLIC KEY-----
'</esi:assign><esi:vars>$assertEqual('rsaPublicKeyPem(\'iXn-WmrwL...Tnrw==\', \'AQAB\')',$rsaPublicKeyPem($(modulus),$(exponent)),$(pem))</esi:vars>